import{_ as s,c as i,o as a,a2 as n}from"./chunks/framework.DTU5Z1Qv.js";const t="/Discuz-Q-Plugin-Development-documentation/assets/hook_develop-1.Cn1g39M-.png",_=JSON.parse('{"title":"钩子开发","description":"","frontmatter":{},"headers":[],"relativePath":"hooks/hook_develop.md","filePath":"hooks/hook_develop.md","lastUpdated":1711684263000}'),p={name:"hooks/hook_develop.md"},l=n('<h1 id="钩子开发" tabindex="-1">钩子开发 <a class="header-anchor" href="#钩子开发" aria-label="Permalink to &quot;钩子开发&quot;">​</a></h1><p>目前钩子开发需要改写源代码，如果只是插件开发者可以跳过，如果你想深度的二次开发，并且自己创建一些钩子出来，建议认真阅读。</p><p>在开始进行钩子开发之前，应该先了解一个插件从编译到注入页面运行时的流程，这样会对后续教学有更加深入的认知。</p><h2 id="构建流程" tabindex="-1">构建流程 <a class="header-anchor" href="#构建流程" aria-label="Permalink to &quot;构建流程&quot;">​</a></h2><p><img src="'+t+`" alt="图片"></p><p>一个完整的插件注入流程主要由以下3个包共通协助完成</p><ul><li>@discuzq/cli</li><li>@discuzq/plugin-center</li><li>@discuzq/discuz-plugin-loader</li></ul><h2 id="如何新增钩子" tabindex="-1">如何新增钩子 <a class="header-anchor" href="#如何新增钩子" aria-label="Permalink to &quot;如何新增钩子&quot;">​</a></h2><p>对于新增钩子有严格的要求，禁止顺便新增钩子，如果需要新增钩子，首先需要在<code>@discuzq/plugin-center</code>中，<code>injections</code>目录下新增对应钩子函数。在运行时，注入组件时必须要在<code>@discuzq/plugin-center</code>中找到对应钩子的注入器进行插件注入。</p><h3 id="添加target" tabindex="-1">添加target <a class="header-anchor" href="#添加target" aria-label="Permalink to &quot;添加target&quot;">​</a></h3><p>在<code>discuz-plugin-center/src/const.js</code>文件中添加新的<code>target</code>。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PLUGIN_TARGET_LIST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_system&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_index&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_detail&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_page&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><h3 id="添加注入器" tabindex="-1">添加注入器 <a class="header-anchor" href="#添加注入器" aria-label="Permalink to &quot;添加注入器&quot;">​</a></h3><p>在<code>discuz-plugin-center/src/injections/index.js</code>文件中添加新的注入器</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plugin_detail2thread_extension_display_hook </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./plugin_detail@thread_extension_display_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plugin_index2thread_extension_display_hook </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./plugin_index@thread_extension_display_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plugin_post2post_extension_content_hook </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./plugin_post@post_extension_content_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plugin_post2post_extension_entry_hook </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./plugin_post@post_extension_entry_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plugin_system2add_page_hook </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./plugin_system@add_page_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> INJECTION_LIST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_post@post_extension_entry_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: plugin_post2post_extension_entry_hook,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_post@post_extension_content_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: plugin_post2post_extension_content_hook,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_index@thread_extension_display_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: plugin_index2thread_extension_display_hook,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_detail@thread_extension_display_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: plugin_detail2thread_extension_display_hook,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;plugin_system@add_page_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: plugin_system2add_page_hook</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getInjection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INJECTION_LIST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[name] ) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> INJECTION_LIST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[name];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>目前@discuzq/plugin-center未开源，开源后可自行修改.</p></blockquote>`,16),e=[l];function h(k,o,d,r,E,g){return a(),i("div",null,e)}const y=s(p,[["render",h]]);export{_ as __pageData,y as default};
